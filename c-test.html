<HTML>
<HEAD>
<META charset="UTF-8">
<SCRIPT>

	var g_wa;
	var memory_bytes; //Actually a  UInt8Array of the memory object.
	var memory_words; //Actually an Int32Array of the memory object.
function onLoad()
{
	var canvas = document.getElementById( "rawdrawcanvas" );
	var ctx = canvas.getContext("2d");
	var lastx=null, lasty=null;

	function UTF8ToString( memory_address ) { memory_address |= 0; var ret = ""; var ch = 0|0; for( var v = memory_address; ch = memory_bytes[v]; v++ ) ret += String.fromCharCode(ch); return ret; }

	var wasmblob = atob( "\
AGFzbQEAAAABGAVgAABgAX8AYAF9AX1gBH9/f38AYAABfwJUBQNlbnYLY2FudmFzQ2xlYXIAAANl\
		bnYJYmVnaW5QYXRoAAADZW52C3RhY2tTZWdtZW50AAMDZW52BnN0cm9rZQAAA2VudgtzdWJtaXRG\
		cmFtZQAAAwkIAgIAAQABAAQEBQFwAQEBBQMBAAIGEgN/AUGAiAQLfwFBAAt/AUEACweJAQcGbWVt\
		b3J5AgAJYW5pbWF0aW9uAAcVYXN5bmNpZnlfc3RhcnRfdW53aW5kAAgUYXN5bmNpZnlfc3RvcF91\
		bndpbmQACRVhc3luY2lmeV9zdGFydF9yZXdpbmQAChRhc3luY2lmeV9zdG9wX3Jld2luZAALEmFz\
		eW5jaWZ5X2dldF9zdGF0ZQAMCrgXCEoCCX8GfSMAIQQgBCEBQRAhAiABIQUgAiEGIAUgBmshByAH\
		IQMgAyEIIAAhCyAIIAs4AgwgAyEJIAkqAgwhDCAMIQogCiENIA0PC0oCCX8GfSMAIQQgBCEBQRAh\
		AiABIQUgAiEGIAUgBmshByAHIQMgAyEIIAAhCyAIIAs4AgwgAyEJIAkqAgwhDCAMIQogCiENIA0P\
		C7oVA7gBf2Z9H3wjAUECRgRAIwIjAigCAEFoajYCACMCKAIAIbYBILYBKAIAIQIgtgEoAgQhBCC2\
		ASgCCCGeASC2ASgCDCGfASC2ASgCECGgASC2ASgCFCGhAQsCfwJAAkAjAUECRgRAIwIjAigCAEF8\
		ajYCACMCKAIAKAIAIbUBCwJAIwFBAEYEQCMAITogOiEAQSAhASAAITsgASE8IDsgPGshPSA9IQIg\
		AiE+ID4kAEEAIQMgAiE/IAMhQCA/IEA2AhxBACEECwEBAQEBAQEBAQEBAQEjAUEARgR/QQEFILUB\
		QQBGCwRAEAAjAUEBRgRAQQAMBQsLIwFBAEYEf0EBBSC1AUEBRgsEQBABIwFBAUYEQEEBDAULCyMB\
		QQBGBEAgAiFBIAQhQiBBIEI2AhgLAQECQANAIwFBAEYEQEE+IQUgAiFDIEMoAhghRCBEIQYgBiFF\
		IEUhByAFIUYgRiEIIAchRyAIIUggRyBITCFJIEkhCUEBIQogCSFKIAohSyBKIEtxIUwgTCELIAsh\
		TSBNRSFOIE4NAkH4ACEMIAIhTyAMIVAgTyBQNgIUIAIhUSAMIVIgUSBSNgIQQcACIQ0gAiFTIA0h\
		VCBTIFQ2AgxB8AEhDiACIVUgDiFWIFUgVjYCCCACIVcgVygCGCFYIFghDyAPIVkgWbchqQIgqQIh\
		ngJEAAAAAAAAJEAhnwIgngIhqgIgnwIhqwIgqgIgqwKjIawCIKwCIaACIAIhWiBaKAIcIVsgWyEQ\
		IBAhXCBctyGtAiCtAiGhAkQAAAAAAABOQCGiAiChAiGuAiCiAiGvAiCuAiCvAqMhsAIgsAIhowIg\
		oAIhsQIgowIhsgIgsQIgsgKgIbMCILMCIaQCIKQCIbQCILQCtiHaASDaASG4ASACIV0guAEh2wEg\
		XSDbATgCBCACIV4gXigCGCFfIF8hESARIWAgYLchtQIgtQIhpQIgpQIhtgIgnwIhtwIgtgIgtwKj\
		IbgCILgCIaYCRAAAAAAAAPA/IacCIKYCIbkCIKcCIboCILkCILoCoCG7AiC7AiGoAiCoAiG8AiC8\
		ArYh3AEg3AEhuQEgAiFhILkBId0BIGEg3QE4AgAgAiFiIGIoAgwhYyBjIRIgEiFkIGSyId4BIN4B\
		IboBIAIhZSBlKgIEId8BIN8BIbsBILsBIeABIOABEAUh4QEg4QEhvAEgAiFmIGYoAhQhZyBnIRMg\
		EyFoIGiyIeIBIOIBIb0BILwBIeMBIL0BIeQBIOMBIOQBlCHlASDlASG+ASC6ASHmASC+ASHnASDm\
		ASDnAZIh6AEg6AEhvwEgvwEh6QEg6QGLIeoBIOoBIcABQwAAAE8hwQEgwAEh6wEgwQEh7AEg6wEg\
		7AFdIWkgaSEUIBQhaiBqRSFrIGshFQJAAkAgFSFsIGwNACC/ASHtASDtAaghbSBtIRYgFiFuIG4h\
		FwwBC0GAgICAeCEYIBghbyBvIRcLIBchcCBwIRkgAiFxIHEoAgghciByIRogGiFzIHOyIe4BIO4B\
		IcIBIAIhdCB0KgIEIe8BIO8BIcMBIMMBIfABIPABEAYh8QEg8QEhxAEgAiF1IHUoAhQhdiB2IRsg\
		GyF3IHeyIfIBIPIBIcUBIMQBIfMBIMUBIfQBIPMBIPQBlCH1ASD1ASHGASDCASH2ASDGASH3ASD2\
		ASD3AZIh+AEg+AEhxwEgxwEh+QEg+QGLIfoBIPoBIcgBQwAAAE8hyQEgyAEh+wEgyQEh/AEg+wEg\
		/AFdIXggeCEcIBwheSB5RSF6IHohHQJAAkAgHSF7IHsNACDHASH9ASD9AaghfCB8IR4gHiF9IH0h\
		HwwBC0GAgICAeCEgICAhfiB+IR8LIB8hfyB/ISEgAiGAASCAASgCDCGBASCBASEiICIhggEgggGy\
		If4BIP4BIcoBIAIhgwEggwEqAgAh/wEg/wEhywEgywEhgAIggAIQBSGBAiCBAiHMASACIYQBIIQB\
		KAIQIYUBIIUBISMgIyGGASCGAbIhggIgggIhzQEgzAEhgwIgzQEhhAIggwIghAKUIYUCIIUCIc4B\
		IMoBIYYCIM4BIYcCIIYCIIcCkiGIAiCIAiHPASDPASGJAiCJAoshigIgigIh0AFDAAAATyHRASDQ\
		ASGLAiDRASGMAiCLAiCMAl0hhwEghwEhJCAkIYgBIIgBRSGJASCJASElAkACQCAlIYoBIIoBDQAg\
		zwEhjQIgjQKoIYsBIIsBISYgJiGMASCMASEnDAELQYCAgIB4ISggKCGNASCNASEnCyAnIY4BII4B\
		ISkgAiGPASCPASgCCCGQASCQASEqICohkQEgkQGyIY4CII4CIdIBIAIhkgEgkgEqAgAhjwIgjwIh\
		0wEg0wEhkAIgkAIQBiGRAiCRAiHUASACIZMBIJMBKAIQIZQBIJQBISsgKyGVASCVAbIhkgIgkgIh\
		1QEg1AEhkwIg1QEhlAIgkwIglAKUIZUCIJUCIdYBINIBIZYCINYBIZcCIJYCIJcCkiGYAiCYAiHX\
		ASDXASGZAiCZAoshmgIgmgIh2AFDAAAATyHZASDYASGbAiDZASGcAiCbAiCcAl0hlgEglgEhLCAs\
		IZcBIJcBRSGYASCYASEtAkACQCAtIZkBIJkBDQAg1wEhnQIgnQKoIZoBIJoBIS4gLiGbASCbASEv\
		DAELQYCAgIB4ITAgMCGcASCcASEvCyAvIZ0BIJ0BITEgGSGeASAhIZ8BICkhoAEgMSGhAQsBAQEB\
		AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEB\
		AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEB\
		AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEB\
		AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEB\
		AQEBAQEBAQEBAQEBAQEBAQEBASMBQQBGBH9BAQUgtQFBAkYLBEAgngEgnwEgoAEgoQEQAiMBQQFG\
		BEBBAgwHCwsjAUEARgRAIAIhogEgogEoAhghowEgowEhMkEBITMgMiGkASAzIaUBIKQBIKUBaiGm\
		ASCmASE0IAIhpwEgNCGoASCnASCoATYCGAwBCwEBAQEBAQEBAQEBCwsjAUEARgR/QQEFILUBQQNG\
		CwRAEAMjAUEBRgRAQQMMBQsLIwFBAEYEf0EBBSC1AUEERgsEQBAEIwFBAUYEQEEEDAULCyMBQQBG\
		BEAgAiGpASCpASgCHCGqASCqASE1QQEhNiA1IasBIDYhrAEgqwEgrAFqIa0BIK0BITcgAiGuASA3\
		Ia8BIK4BIK8BNgIcQSAhOCACIbABIDghsQEgsAEgsQFqIbIBILIBITkgOSGzASCzASQADwsBAQEB\
		AQEBAQEBAQEBAQEBAQELCw8LAAshtAECQCMCKAIAILQBNgIAIwIjAigCAEEEajYCAAsCQCMCKAIA\
		IbcBILcBIAI2AgAgtwEgBDYCBCC3ASCeATYCCCC3ASCfATYCDCC3ASCgATYCECC3ASChATYCFCMC\
		IwIoAgBBGGo2AgALCxkAQQEkASAAJAIjAigCACMCKAIESwRAAAsLFQBBACQBIwIoAgAjAigCBEsE\
		QAALCxkAQQIkASAAJAIjAigCACMCKAIESwRAAAsLFQBBACQBIwIoAgAjAigCBEsEQAALCwQAIwEL\
		ACYJcHJvZHVjZXJzAQxwcm9jZXNzZWQtYnkBBWNsYW5nBjEwLjAuMQ==\
			");

	var array = new Uint8Array(new ArrayBuffer(wasmblob.length));
	for(i = 0; i < wasmblob.length; i++) {
		array[i] = wasmblob.charCodeAt(i);
	}

	var imports = {
		env : {
			canvasClear : function() { ctx.clearRect(0, 0, canvas.width, canvas.height); },
			beginPath : function() { ctx.beginPath(); },
			tackSegment: function( x1, y1, x2, y2 ) { if( x1 !== lastx || y1 !== lasty ) { ctx.moveTo( x1, y1 ); } ctx.lineTo( x2, y2 ); lastx = x1; lasty = y1; },
			stroke : function() { ctx.stroke(); },
			logInt : function( x ) { console.log(x); }
		}
	};

	WebAssembly.instantiate( array, imports ).then( 
		function(wa) {
			g_wa = wa;
			//memory_bytes = new Uint8Array(g_wa.instance.exports.memory.buffer);
			//memory_words = new Int32Array(g_wa.instance.exports.memory.buffer);
			console.log( wa );
			console.log( wa.instance );
			g_wa.instance.exports.run();
		}
	);
}

</SCRIPT>
</HEAD>
<BODY onLoad=onLoad()>
<TABLE border=1><TR><TD WIDTH=640>
<DIV STYLE="position:absolute;width:640">
<DIV>This is an example of a fully integrated wasm page.  It shows how you can run wasm without fetch() or anything so it loads super quick even over connections with really high latency, or you can run it from your hard drive just by double clicking on it.  Check out the project here: <A HREF=https://github.com/cnlohr/wasm_integrated>https://github.com/cnlohr/wasm_integrated</A>.</DIV>
</DIV>
<DIV STYLE="positon:absolute;z-index:3">
<CANVAS ID=rawdrawcanvas WIDTH=640 HEIGHT=480></CANVAS>
</DIV>
</TD></TR></TABLE>
</BODY>
</HTML>

