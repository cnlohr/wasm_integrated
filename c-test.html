<HTML>
<HEAD>
<META charset="UTF-8">
<SCRIPT>

	var g_wa;
	var memory_bytes; //Actually a  UInt8Array of the memory object.
	var memory_words; //Actually an Int32Array of the memory object.
function onLoad()
{
	var canvas = document.getElementById( "rawdrawcanvas" );
	var ctx = canvas.getContext("2d");
	var lastx=null, lasty=null;

	function UTF8ToString( memory_address ) { memory_address |= 0; var ret = ""; var ch = 0|0; for( var v = memory_address; ch = memory_bytes[v]; v++ ) ret += String.fromCharCode(ch); return ret; }

	var wasmblob = atob( "\
AGFzbQEAAAABEwRgAABgAX8AYAR/f39/AGAAAX8CfAcDZW52C2NhbnZhc0NsZWFyAAADZW52CWJl\
		Z2luUGF0aAAAA2Vudgt0YWNrU2VnbWVudAACA2VudgZzdHJva2UAAANlbnYVcmVxdWVzdEFuaW1h\
		dGlvbkZyYW1lAAADZW52BmxvZ1N0cgABA2VudgpzZXRUaW1lb3V0AAEDDg0AAAAAAAAAAAEAAQAD\
		BAUBcAEBAQUDAQACBhIDfwFBsMgEC38BQQALfwFBAAsH1AEMBm1lbW9yeQIAC3N1Ym1pdEZyYW1l\
		AAcQcmVlbnRlckFuaW1hdGlvbgAJDHJ1bkFuaW1hdGlvbgAKCnRpbWVyU2xlZXAACwxyZWVudGVy\
		VGltZXIADQhydW5UaW1lcgAOFWFzeW5jaWZ5X3N0YXJ0X3Vud2luZAAPFGFzeW5jaWZ5X3N0b3Bf\
		dW53aW5kABAVYXN5bmNpZnlfc3RhcnRfcmV3aW5kABEUYXN5bmNpZnlfc3RvcF9yZXdpbmQAEhJh\
		c3luY2lmeV9nZXRfc3RhdGUAEwqJDg3OAQElf0EAIQBBACEBIAEhECAQLQCgSCERIBEhAkH/ASED\
		IAIhEiADIRMgEiATcSEUIBQhBEH/ASEFIAAhFSAFIRYgFSAWcSEXIBchBiAEIRggBiEZIBggGUch\
		GiAaIQdBASEIIAchGyAIIRwgGyAccSEdIB0hCQJAAkAgCSEeIB4NAEGICCEKIAohHyAfIQtBASEM\
		QQAhDSANISAgDCEhICAgIToAoEggCyEiICIQDwwBC0EAIQ4QEkEAIQ8gDyEjIA4hJCAjICQ6AKBI\
		Cw8L7wYBS38jAUECRgRAIwIjAigCAEFgajYCACMCKAIAIUkgSSgCACECIEkoAgQhBCBJKAIIIQUg\
		SSgCDCEGIEkoAhAhNCBJKAIUITUgSSgCGCE2IEkoAhwhNwsCfwJAAkAjAUECRgRAIwIjAigCAEF8\
		ajYCACMCKAIAKAIAIUgLAkAjAUEARgRAIwAhGiAaIQBBECEBIAAhGyABIRwgGyAcayEdIB0hAiAC\
		IR4gHiQAQQAhAyACIR8gAyEgIB8gIDYCDAsBAQEBAQEBAQEBAQEDQCMBQQBGBEBB5AAhBEGsAiEF\
		QTwhBgsBASMBQQBGBH9BAQUgSEEARgsEQBAAIwFBAUYEQEEADAYLCyMBQQBGBH9BAQUgSEEBRgsE\
		QBABIwFBAUYEQEEBDAYLCyMBQQBGBEAgAiEhICEoAgwhIiAiIQdBPCEIIAchIyAIISQgIyAkbyEl\
		ICUhCUHIASEKIAkhJiAKIScgJiAnaiEoICghCyACISkgKSgCDCEqICohDEE8IQ0gDCErIA0hLCAr\
		ICxvIS0gLSEOIAYhLiAOIS8gLiAvayEwIDAhD0HIASEQIA8hMSAQITIgMSAyaiEzIDMhESAEITQg\
		CyE1IAUhNiARITcLAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBIwFBAEYEf0EBBSBI\
		QQJGCwRAIDQgNSA2IDcQAiMBQQFGBEBBAgwGCwsjAUEARgR/QQEFIEhBA0YLBEAQAyMBQQFGBEBB\
		AwwGCwsjAUEARgR/QQEFIEhBBEYLBEAQByMBQQFGBEBBBAwGCwsjAUEARgRAIAIhOCA4KAIMITkg\
		OSESQQEhEyASITogEyE7IDogO2ohPCA8IRQgAiE9IBQhPiA9ID42AgxBASEVQQEhFiAVIT8gFiFA\
		ID8gQHEhQSBBIRcgFyFCIEINAQsBAQEBAQEBAQEBAQEBAQEBAQELIwFBAEYEQEEQIRggAiFDIBgh\
		RCBDIERqIUUgRSEZIBkhRiBGJAAPCwEBAQEBAQELCw8LAAshRwJAIwIoAgAgRzYCACMCIwIoAgBB\
		BGo2AgALAkAjAigCACFKIEogAjYCACBKIAQ2AgQgSiAFNgIIIEogBjYCDCBKIDQ2AhAgSiA1NgIU\
		IEogNjYCGCBKIDc2AhwjAiMCKAIAQSBqNgIACwsgAQR/QYgIIQAgACECIAIhASABIQMgAxAREAgQ\
		EBAEDwsJABAIEBAQBA8LzgEBJX9BACEAQQAhASABIRAgEC0AoUghESARIQJB/wEhAyACIRIgAyET\
		IBIgE3EhFCAUIQRB/wEhBSAAIRUgBSEWIBUgFnEhFyAXIQYgBCEYIAYhGSAYIBlHIRogGiEHQQEh\
		CCAHIRsgCCEcIBsgHHEhHSAdIQkCQAJAIAkhHiAeDQBBkAghCiAKIR8gHyELQQEhDEEAIQ0gDSEg\
		IAwhISAgICE6AKFIIAshIiAiEA8MAQtBACEOEBJBACEPIA8hIyAOISQgIyAkOgChSAsPC6ICAQ1/\
		IwFBAkYEQCMCIwIoAgBBfGo2AgAjAigCACELIAsoAgAhBAsCfwJAAkAjAUECRgRAIwIjAigCAEF8\
		ajYCACMCKAIAKAIAIQoLAkADQCMBQQBGBEBBgAghACAAIQQLASMBQQBGBH9BAQUgCkEARgsEQCAE\
		EAUjAUEBRgRAQQAMBgsLIwFBAEYEf0EBBSAKQQFGCwRAEAsjAUEBRgRAQQEMBgsLIwFBAEYEQEEB\
		IQFBASECIAEhBSACIQYgBSAGcSEHIAchAyADIQggCA0BCwEBAQEBAQELIwFBAEYEQA8LCwsPCwAL\
		IQkCQCMCKAIAIAk2AgAjAiMCKAIAQQRqNgIACwJAIwIoAgAhDCAMIAQ2AgAjAiMCKAIAQQRqNgIA\
		CwsrAQZ/QegHIQBBkAghASABIQMgAyECIAIhBCAEEBEQDBAQIAAhBSAFEAYPCxYBAn9B6AchABAM\
		EBAgACEBIAEQBg8LGQBBASQBIAAkAiMCKAIAIwIoAgRLBEAACwsVAEEAJAEjAigCACMCKAIESwRA\
		AAsLGQBBAiQBIAAkAiMCKAIAIwIoAgRLBEAACwsVAEEAJAEjAigCACMCKAIESwRAAAsLBAAjAQsL\
		IgIAQYAICwV0aWNrAABBiAgLECAEAAAgFAAAIBQAACAkAAA=\
			");

	var array = new Uint8Array(new ArrayBuffer(wasmblob.length));
	for(i = 0; i < wasmblob.length; i++) {
		array[i] = wasmblob.charCodeAt(i);
	}

	var imports = {
		env : {
			canvasClear : function() { ctx.clearRect(0, 0, canvas.width, canvas.height); },
			beginPath : function() { ctx.beginPath(); },
			tackSegment: function( x1, y1, x2, y2 ) { if( x1 !== lastx || y1 !== lasty ) { ctx.moveTo( x1, y1 ); } ctx.lineTo( x2, y2 ); lastx = x1; lasty = y1; },
			stroke : function() { ctx.stroke(); },
			logStr : function( s ) { console.log(s); },
			requestAnimationFrame : function() { window.requestAnimationFrame(g_wa.instance.exports.reenterAnimation); },
			setTimeout : function( t ) { setTimeout(g_wa.instance.exports.reenterTimer, t); }
		}
	};

	WebAssembly.instantiate( array, imports ).then( 
		function(wa) {
			g_wa = wa;
			//memory_bytes = new Uint8Array(g_wa.instance.exports.memory.buffer);
			//memory_words = new Int32Array(g_wa.instance.exports.memory.buffer);
			console.log( wa );
			console.log( wa.instance );
		}
	);
}

function animation() {
	g_wa.instance.exports.runAnimation();
}
function sleeper() {
	g_wa.instance.exports.runTimer();
}

</SCRIPT>
</HEAD>
<BODY onLoad=onLoad()>
<TABLE border=1><TR><TD WIDTH=640>
<DIV STYLE="position:absolute;width:640">
<DIV>This is an example of a fully integrated wasm page.  It shows how you can run wasm without fetch() or anything so it loads super quick even over connections with really high latency, or you can run it from your hard drive just by double clicking on it.  Check out the project here: <A HREF=https://github.com/cnlohr/wasm_integrated>https://github.com/cnlohr/wasm_integrated</A>.</DIV>
<INPUT value="animation" type=submit onClick="animation()">
<INPUT value="timer" type=submit onClick="sleeper()">
</DIV>
<DIV STYLE="positon:absolute;z-index:3">
<CANVAS ID=rawdrawcanvas WIDTH=640 HEIGHT=480></CANVAS>
</DIV>
</TD></TR></TABLE>
</BODY>
</HTML>

