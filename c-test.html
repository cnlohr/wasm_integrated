<HTML>
<HEAD>
<META charset="UTF-8">
<SCRIPT>

	var g_wa;
	var memory_bytes; //Actually a  UInt8Array of the memory object.
	var memory_words; //Actually an Int32Array of the memory object.
function onLoad()
{
	var canvas = document.getElementById( "rawdrawcanvas" );
	var ctx = canvas.getContext("2d");
	var lastx=null, lasty=null;

	function UTF8ToString( memory_address ) { memory_address |= 0; var ret = ""; var ch = 0|0; for( var v = memory_address; ch = memory_bytes[v]; v++ ) ret += String.fromCharCode(ch); return ret; }

	var wasmblob = atob( "\
AGFzbQEAAAABGAVgAABgAX8AYAF9AX1gBH9/f38AYAABfwKSAQkDZW52C2NhbnZhc0NsZWFyAAAD\
		ZW52CWJlZ2luUGF0aAAAA2VudgRjb3NmAAIDZW52BHNpbmYAAgNlbnYLdGFja1NlZ21lbnQAAwNl\
		bnYGc3Ryb2tlAAADZW52FXJlcXVlc3RBbmltYXRpb25GcmFtZQAAA2VudgZsb2dOdW0AAQNlbnYK\
		c2V0VGltZW91dAABAw4NAAAAAAAAAAABAAEABAQFAXABAQEFAwEAAgYSA38BQaDIBAt/AUEAC38B\
		QQALB9QBDAZtZW1vcnkCAAtzdWJtaXRGcmFtZQAJEHJlZW50ZXJBbmltYXRpb24ACwxydW5Bbmlt\
		YXRpb24ADAp0aW1lclNsZWVwAA0McmVlbnRlclRpbWVyAA8IcnVuVGltZXIAEBVhc3luY2lmeV9z\
		dGFydF91bndpbmQAERRhc3luY2lmeV9zdG9wX3Vud2luZAASFWFzeW5jaWZ5X3N0YXJ0X3Jld2lu\
		ZAATFGFzeW5jaWZ5X3N0b3BfcmV3aW5kABQSYXN5bmNpZnlfZ2V0X3N0YXRlABUKmCINzgEBJX9B\
		ACEAQQAhASABIRAgEC0AkEghESARIQJB/wEhAyACIRIgAyETIBIgE3EhFCAUIQRB/wEhBSAAIRUg\
		BSEWIBUgFnEhFyAXIQYgBCEYIAYhGSAYIBlHIRogGiEHQQEhCCAHIRsgCCEcIBsgHHEhHSAdIQkC\
		QAJAIAkhHiAeDQBBgAghCiAKIR8gHyELQQEhDEEAIQ0gDSEgIAwhISAgICE6AJBIIAshIiAiEBEM\
		AQtBACEOEBRBACEPIA8hIyAOISQgIyAkOgCQSAsPC8IZA78Bf2d9H3wjAUECRgRAIwIjAigCAEGs\
		f2o2AgAjAigCACG9ASC9ASgCACECIL0BKAIEIQQgvQEqAgghwQEgvQEoAgwhGSC9ASoCECHJASC9\
		ASgCFCEhIL0BKgIYIdEBIL0BKAIcISkgvQEqAiAh2QEgvQEqAiQh5wEgvQEqAigh6AEgvQEqAiwh\
		9wEgvQEqAjAh+AEgvQEqAjQhhwIgvQEqAjghiAIgvQEqAjwhlwIgvQEqAkAhmAIgvQEoAkQhoQEg\
		vQEoAkghogEgvQEoAkwhowEgvQEoAlAhpAELAn8CQAJAIwFBAkYEQCMCIwIoAgBBfGo2AgAjAigC\
		ACgCACG8AQsCQCMBQQBGBEAjACE9ID0hAEEgIQEgACE+IAEhPyA+ID9rIUAgQCECIAIhQSBBJABB\
		ACEDIAIhQiADIUMgQiBDNgIcCwEBAQEBAQEBAQEBAQNAIwFBAEYEQEEAIQQLIwFBAEYEf0EBBSC8\
		AUEARgsEQBAAIwFBAUYEQEEADAYLCyMBQQBGBH9BAQUgvAFBAUYLBEAQASMBQQFGBEBBAQwGCwsj\
		AUEARgRAIAIhRCAEIUUgRCBFNgIYCwEBAkADQCMBQQBGBEBBPiEFIAIhRiBGKAIYIUcgRyEGIAYh\
		SCBIIQcgBSFJIEkhCCAHIUogCCFLIEogS0whTCBMIQlBASEKIAkhTSAKIU4gTSBOcSFPIE8hCyAL\
		IVAgUEUhUSBRDQJB+AAhDCACIVIgDCFTIFIgUzYCFCACIVQgDCFVIFQgVTYCEEHAAiENIAIhViAN\
		IVcgViBXNgIMQfABIQ4gAiFYIA4hWSBYIFk2AgggAiFaIFooAhghWyBbIQ8gDyFcIFy3IbECILEC\
		IaYCRAAAAAAAACRAIacCIKYCIbICIKcCIbMCILICILMCoyG0AiC0AiGoAiACIV0gXSgCHCFeIF4h\
		ECAQIV8gX7chtQIgtQIhqQJEAAAAAAAATkAhqgIgqQIhtgIgqgIhtwIgtgIgtwKjIbgCILgCIasC\
		IKgCIbkCIKsCIboCILkCILoCoCG7AiC7AiGsAiCsAiG8AiC8ArYh4QEg4QEhvwEgAiFgIL8BIeIB\
		IGAg4gE4AgQgAiFhIGEoAhghYiBiIREgESFjIGO3Ib0CIL0CIa0CIK0CIb4CIKcCIb8CIL4CIL8C\
		oyHAAiDAAiGuAkQAAAAAAADwPyGvAiCuAiHBAiCvAiHCAiDBAiDCAqAhwwIgwwIhsAIgsAIhxAIg\
		xAK2IeMBIOMBIcABIAIhZCDAASHkASBkIOQBOAIAIAIhZSBlKAIMIWYgZiESIBIhZyBnsiHlASDl\
		ASHBASACIWggaCoCBCHmASDmASHCASDCASHnAQsBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEB\
		AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEB\
		AQEBAQEBAQEBAQEBIwFBAEYEf0EBBSC8AUECRgsEQCDnARACIaUCIwFBAUYEQEECDAgFIKUCIegB\
		CwsjAUEARgRAIOgBIcMBIAIhaSBpKAIUIWogaiETIBMhayBrsiHpASDpASHEASDDASHqASDEASHr\
		ASDqASDrAZQh7AEg7AEhxQEgwQEh7QEgxQEh7gEg7QEg7gGSIe8BIO8BIcYBIMYBIfABIPABiyHx\
		ASDxASHHAUMAAABPIcgBIMcBIfIBIMgBIfMBIPIBIPMBXSFsIGwhFCAUIW0gbUUhbiBuIRUCQAJA\
		IBUhbyBvDQAgxgEh9AEg9AGoIXAgcCEWIBYhcSBxIRcMAQtBgICAgHghGCAYIXIgciEXCyAXIXMg\
		cyEZIAIhdCB0KAIIIXUgdSEaIBohdiB2siH1ASD1ASHJASACIXcgdyoCBCH2ASD2ASHKASDKASH3\
		AQsBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBASMBQQBGBH9BAQUgvAFBA0YL\
		BEAg9wEQAyGlAiMBQQFGBEBBAwwIBSClAiH4AQsLIwFBAEYEQCD4ASHLASACIXggeCgCFCF5IHkh\
		GyAbIXogerIh+QEg+QEhzAEgywEh+gEgzAEh+wEg+gEg+wGUIfwBIPwBIc0BIMkBIf0BIM0BIf4B\
		IP0BIP4BkiH/ASD/ASHOASDOASGAAiCAAoshgQIggQIhzwFDAAAATyHQASDPASGCAiDQASGDAiCC\
		AiCDAl0heyB7IRwgHCF8IHxFIX0gfSEdAkACQCAdIX4gfg0AIM4BIYQCIIQCqCF/IH8hHiAeIYAB\
		IIABIR8MAQtBgICAgHghICAgIYEBIIEBIR8LIB8hggEgggEhISACIYMBIIMBKAIMIYQBIIQBISIg\
		IiGFASCFAbIhhQIghQIh0QEgAiGGASCGASoCACGGAiCGAiHSASDSASGHAgsBAQEBAQEBAQEBAQEB\
		AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBASMBQQBGBH9BAQUgvAFBBEYLBEAghwIQAiGlAiMBQQFG\
		BEBBBAwIBSClAiGIAgsLIwFBAEYEQCCIAiHTASACIYcBIIcBKAIQIYgBIIgBISMgIyGJASCJAbIh\
		iQIgiQIh1AEg0wEhigIg1AEhiwIgigIgiwKUIYwCIIwCIdUBINEBIY0CINUBIY4CII0CII4CkiGP\
		AiCPAiHWASDWASGQAiCQAoshkQIgkQIh1wFDAAAATyHYASDXASGSAiDYASGTAiCSAiCTAl0higEg\
		igEhJCAkIYsBIIsBRSGMASCMASElAkACQCAlIY0BII0BDQAg1gEhlAIglAKoIY4BII4BISYgJiGP\
		ASCPASEnDAELQYCAgIB4ISggKCGQASCQASEnCyAnIZEBIJEBISkgAiGSASCSASgCCCGTASCTASEq\
		ICohlAEglAGyIZUCIJUCIdkBIAIhlQEglQEqAgAhlgIglgIh2gEg2gEhlwILAQEBAQEBAQEBAQEB\
		AQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEjAUEARgR/QQEFILwBQQVGCwRAIJcCEAMhpQIjAUEB\
		RgRAQQUMCAUgpQIhmAILCyMBQQBGBEAgmAIh2wEgAiGWASCWASgCECGXASCXASErICshmAEgmAGy\
		IZkCIJkCIdwBINsBIZoCINwBIZsCIJoCIJsClCGcAiCcAiHdASDZASGdAiDdASGeAiCdAiCeApIh\
		nwIgnwIh3gEg3gEhoAIgoAKLIaECIKECId8BQwAAAE8h4AEg3wEhogIg4AEhowIgogIgowJdIZkB\
		IJkBISwgLCGaASCaAUUhmwEgmwEhLQJAAkAgLSGcASCcAQ0AIN4BIaQCIKQCqCGdASCdASEuIC4h\
		ngEgngEhLwwBC0GAgICAeCEwIDAhnwEgnwEhLwsgLyGgASCgASExIBkhoQEgISGiASApIaMBIDEh\
		pAELAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEjAUEARgR/QQEFILwBQQZGCwRAIKEB\
		IKIBIKMBIKQBEAQjAUEBRgRAQQYMCAsLIwFBAEYEQCACIaUBIKUBKAIYIaYBIKYBITJBASEzIDIh\
		pwEgMyGoASCnASCoAWohqQEgqQEhNCACIaoBIDQhqwEgqgEgqwE2AhgMAQsBAQEBAQEBAQEBAQsL\
		IwFBAEYEf0EBBSC8AUEHRgsEQBAFIwFBAUYEQEEHDAYLCyMBQQBGBH9BAQUgvAFBCEYLBEAQCSMB\
		QQFGBEBBCAwGCwsjAUEARgRAIAIhrAEgrAEoAhwhrQEgrQEhNUEBITYgNSGuASA2Ia8BIK4BIK8B\
		aiGwASCwASE3IAIhsQEgNyGyASCxASCyATYCHEEBIThBASE5IDghswEgOSG0ASCzASC0AXEhtQEg\
		tQEhOiA6IbYBILYBDQELAQEBAQEBAQEBAQEBAQEBAQEBCyMBQQBGBEBBICE7IAIhtwEgOyG4ASC3\
		ASC4AWohuQEguQEhPCA8IboBILoBJAAPCwEBAQEBAQELCw8LAAshuwECQCMCKAIAILsBNgIAIwIj\
		AigCAEEEajYCAAsCQCMCKAIAIb4BIL4BIAI2AgAgvgEgBDYCBCC+ASDBATgCCCC+ASAZNgIMIL4B\
		IMkBOAIQIL4BICE2AhQgvgEg0QE4AhggvgEgKTYCHCC+ASDZATgCICC+ASDnATgCJCC+ASDoATgC\
		KCC+ASD3ATgCLCC+ASD4ATgCMCC+ASCHAjgCNCC+ASCIAjgCOCC+ASCXAjgCPCC+ASCYAjgCQCC+\
		ASChATYCRCC+ASCiATYCSCC+ASCjATYCTCC+ASCkATYCUCMCIwIoAgBB1ABqNgIACwsgAQR/QYAI\
		IQAgACECIAIhASABIQMgAxATEAoQEhAGDwsJABAKEBIQBg8LzgEBJX9BACEAQQAhASABIRAgEC0A\
		kUghESARIQJB/wEhAyACIRIgAyETIBIgE3EhFCAUIQRB/wEhBSAAIRUgBSEWIBUgFnEhFyAXIQYg\
		BCEYIAYhGSAYIBlHIRogGiEHQQEhCCAHIRsgCCEcIBsgHHEhHSAdIQkCQAJAIAkhHiAeDQBBiAgh\
		CiAKIR8gHyELQQEhDEEAIQ0gDSEgIAwhISAgICE6AJFIIAshIiAiEBEMAQtBACEOEBRBACEPIA8h\
		IyAOISQgIyAkOgCRSAsPC94DASd/IwFBAkYEQCMCIwIoAgBBeGo2AgAjAigCACElICUoAgAhAiAl\
		KAIEIRoLAn8CQAJAIwFBAkYEQCMCIwIoAgBBfGo2AgAjAigCACgCACEkCwJAIwFBAEYEQCMAIQwg\
		DCEAQRAhASAAIQ0gASEOIA0gDmshDyAPIQIgAiEQIBAkAEEAIQMgAiERIAMhEiARIBI2AgwLAQEB\
		AQEBAQEBAQEBA0AjAUEARgRAIAIhEyATKAIMIRQgFCEEQQEhBSAEIRUgBSEWIBUgFmohFyAXIQYg\
		AiEYIAYhGSAYIBk2AgwgBiEaCwEBAQEBAQEBAQEBIwFBAEYEf0EBBSAkQQBGCwRAIBoQByMBQQFG\
		BEBBAAwGCwsjAUEARgR/QQEFICRBAUYLBEAQDSMBQQFGBEBBAQwGCwsjAUEARgRAQQEhB0EBIQgg\
		ByEbIAghHCAbIBxxIR0gHSEJIAkhHiAeDQELAQEBAQEBAQsjAUEARgRAQRAhCiACIR8gCiEgIB8g\
		IGohISAhIQsgCyEiICIkAA8LAQEBAQEBAQsLDwsACyEjAkAjAigCACAjNgIAIwIjAigCAEEEajYC\
		AAsCQCMCKAIAISYgJiACNgIAICYgGjYCBCMCIwIoAgBBCGo2AgALCysBBn9B6AchAEGICCEBIAEh\
		AyADIQIgAiEEIAQQExAOEBIgACEFIAUQCA8LFgECf0HoByEAEA4QEiAAIQEgARAIDwsZAEEBJAEg\
		ACQCIwIoAgAjAigCBEsEQAALCxUAQQAkASMCKAIAIwIoAgRLBEAACwsZAEECJAEgACQCIwIoAgAj\
		AigCBEsEQAALCxUAQQAkASMCKAIAIwIoAgRLBEAACwsEACMBCwsXAQBBgAgLEBAEAAAQFAAAEBQA\
		ABAkAAA=\
			");

	var array = new Uint8Array(new ArrayBuffer(wasmblob.length));
	for(i = 0; i < wasmblob.length; i++) {
		array[i] = wasmblob.charCodeAt(i);
	}

	var imports = {
		env : {
			canvasClear : function() { ctx.clearRect(0, 0, canvas.width, canvas.height); },
			beginPath : function() { ctx.beginPath(); },
			tackSegment: function( x1, y1, x2, y2 ) { if( x1 !== lastx || y1 !== lasty ) { ctx.moveTo( x1, y1 ); } ctx.lineTo( x2, y2 ); lastx = x1; lasty = y1; },
			stroke : function() { ctx.stroke(); },
			logNum : function( x ) { console.log(x); },
			requestAnimationFrame : function() { window.requestAnimationFrame(g_wa.instance.exports.reenterAnimation); },
			setTimeout : function( t ) { setTimeout(g_wa.instance.exports.reenterTimer, t); },
			sinf : function( x ) { return Math.sin(x); },
			cosf : function( x ) { return Math.cos(x); }
		}
	};

	WebAssembly.instantiate( array, imports ).then( 
		function(wa) {
			g_wa = wa;
			//memory_bytes = new Uint8Array(g_wa.instance.exports.memory.buffer);
			//memory_words = new Int32Array(g_wa.instance.exports.memory.buffer);
			console.log( wa );
			console.log( wa.instance );
		}
	);
}

function animation() {
	g_wa.instance.exports.runAnimation();
}
function sleeper() {
	g_wa.instance.exports.runTimer();
}

</SCRIPT>
</HEAD>
<BODY onLoad=onLoad()>
<TABLE border=1><TR><TD WIDTH=640>
<DIV STYLE="position:absolute;width:640">
<DIV>This is an example of a fully integrated wasm page.  It shows how you can run wasm without fetch() or anything so it loads super quick even over connections with really high latency, or you can run it from your hard drive just by double clicking on it.  Check out the project here: <A HREF=https://github.com/cnlohr/wasm_integrated>https://github.com/cnlohr/wasm_integrated</A>.</DIV>
<INPUT value="animation" type=submit onClick="animation()">
<INPUT value="timer" type=submit onClick="sleeper()">
</DIV>
<DIV STYLE="positon:absolute;z-index:3">
<CANVAS ID=rawdrawcanvas WIDTH=640 HEIGHT=480></CANVAS>
</DIV>
</TD></TR></TABLE>
</BODY>
</HTML>

